<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>&quot;routes/index&quot; | membership-form</title>
	<meta name="description" content="Documentation for membership-form">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../assets/js/search.json" data-base="..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../index.html" class="title">membership-form</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../globals.html">Globals</a>
				</li>
				<li>
					<a href="_routes_index_.html">&quot;routes/index&quot;</a>
				</li>
			</ul>
			<h1>Module &quot;routes/index&quot;</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<section class="tsd-panel tsd-comment">
				<div class="tsd-comment tsd-typography">
					<div class="lead">
						<a href="#routes-gt-indexts" id="routes-gt-indexts" style="color: inherit; text-decoration: none;">
							<h1>Routes &gt; index.ts</h1>
						</a>
					</div>
					<hr>
					<p>Main route file. This route triggers only with a POST request, and only if it contains the correct header.</p>
					<p>Currently there&#39;s a custom header, <code>query-kind</code>. It may contain:</p>
					<ul>
						<li>leadgen</li>
						<li>membership</li>
						<li>verification</li>
					</ul>
					<p>Each triggers a different action, but they all revolve around parsing the data and storing it in the database.
					We use SQLite as the database because this is very low-volume so simplicity and portability was much more important than performance.</p>
					<a href="#leadgen--post" id="leadgen--post" style="color: inherit; text-decoration: none;">
						<h4>leadgen | <code>POST</code></h4>
					</a>
					<p><code>leadgen</code> grabs the data from the form present in the website, parses it and stores it in the database.
					It then triggers an email asking for verification.</p>
					<a href="#verifcation--post" id="verifcation--post" style="color: inherit; text-decoration: none;">
						<h4>verifcation | <code>POST</code></h4>
					</a>
					<p><code>verification</code> sets the verified status of a lead with an unique token, and triggers a second email, with some info and stuff and asking if
						they want to apply for membership.
					This link contains the unique token of the verification, which is then read by the membership form page where it leads to.</p>
					<a href="#membership--post" id="membership--post" style="color: inherit; text-decoration: none;">
						<h4>membership | <code>POST</code></h4>
					</a>
					<p><code>membership</code> grabs the data sent by the membership form page, stores it in the database and triggers an email to <a href="mailto:&#99;&#111;&#110;&#116;&#97;&#99;&#116;&#111;&#x40;&#x6e;&#x6f;&#x64;&#111;&#x61;&#x6d;&#x62;&#x69;&#101;&#x6e;&#116;&#97;&#x6c;&#x2e;&#111;&#114;&#103;">&#99;&#111;&#110;&#116;&#97;&#99;&#116;&#111;&#x40;&#x6e;&#x6f;&#x64;&#111;&#x61;&#x6d;&#x62;&#x69;&#101;&#x6e;&#116;&#97;&#x6c;&#x2e;&#111;&#114;&#103;</a> informing
					that someon wants to apply for membership.</p>
				</div>
			</section>
			<section class="tsd-panel-group tsd-index-group">
				<h2>Index</h2>
				<section class="tsd-panel tsd-index-panel">
					<div class="tsd-index-content">
						<section class="tsd-index-section ">
							<h3>Variables</h3>
							<ul class="tsd-index-list">
								<li class="tsd-kind-variable tsd-parent-kind-module"><a href="_routes_index_.html#postroute" class="tsd-kind-icon">Post<wbr>Route</a></li>
								<li class="tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported"><a href="_routes_index_.html#leadstable" class="tsd-kind-icon">leads<wbr>Table</a></li>
								<li class="tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported"><a href="_routes_index_.html#membership_applicantstable" class="tsd-kind-icon">membership_<wbr>applicants<wbr>Table</a></li>
								<li class="tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported"><a href="_routes_index_.html#router" class="tsd-kind-icon">router</a></li>
							</ul>
						</section>
					</div>
				</section>
			</section>
			<section class="tsd-panel-group tsd-member-group ">
				<h2>Variables</h2>
				<section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-module">
					<a name="postroute" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagConst">Const</span> Post<wbr>Route</h3>
					<div class="tsd-signature tsd-kind-icon">Post<wbr>Route<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Router</span><span class="tsd-signature-symbol"> = router.post(&quot;/&quot;, (request, response) &#x3D;&gt; {const query_kind &#x3D; request.headers[&quot;query-kind&quot;] // Header required to know that it&#x27;s a valid request and not random stuffif (query_kind !&#x3D;&#x3D; undefined || query_kind !&#x3D;&#x3D; null) {const query &#x3D; new queryHandler(request, response, {leads: leadsTable,membership: membership_applicantsTable,})switch (query_kind) {case &quot;leadgen&quot;:query.leadgenQuery()// email stuff goes herereturncase &quot;verification&quot;:query.verificationQuery()// email stuff goes herereturncase &quot;membership&quot;:query.membershipQuery()// email stuff goes herereturndefault:return}}})</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in <a href="https://github.com/aordano/membership-form/blob/fd09695/src/routes/index.ts#L124">routes/index.ts:124</a></li>
						</ul>
					</aside>
					<div class="tsd-comment tsd-typography">
						<div class="lead">
							<a href="#postroute" id="postroute" style="color: inherit; text-decoration: none;">
								<h2><code>PostRoute</code></h2>
							</a>
						</div>
						<hr>
						<a href="#description" id="description" style="color: inherit; text-decoration: none;">
							<h3>Description</h3>
						</a>
						<p>Handles all the stuff going on in the endpoint.</p>
						<p>Simply put, someone sends a <code>POST</code> request to the endpoint, and given it has a header <code>query-kind</code> containing, well, the query kind, it
							will process the data in the body to do databasey stuff. The request expected is <code>application-json</code>, so the body should contain a set of keys and
						values with all the info.</p>
						<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
							<h3>Usage</h3>
						</a>
						<p>You receive data in a <code>POST</code> request from a contact form present on the main website. This is  a <code>leadgen</code> query-kind.</p>
						<p>This data is then registered in the database, always even if it&#39;s garbage or anything is dropped in a later step,
						and an email is triggered to the inbox provided, to verify it.</p>
						<p>This verification email contains a link pointing back to the endpoint, where the query-kind now is <code>verification</code>, containing simply the primary
							key generated in the leads table when the data was registered. If the given number matches a entry in the DB, then a hopefully unique token is generated
						and the data in the leads table is updated with this verification token.</p>
						<p>Upon verification, <em>another</em> mail is sent saying that everything went smoothly, and prompting the user to contact the organization, opt to become a member
						donate money or something, and pointing to where&#39;s our cool stuff and that go go check it out.</p>
						<p>If the user choses to apply for memebership, then it&#39;s redirected to another form where more sensitive data is requested. This form is reached
							via a <code>GET</code> request containing the verification token assigned to the user. Then when the form is filled, the verification token is passed along it in
						another <code>POST</code> request to the endpoint, this time with <code>membership</code> query-kind.</p>
						<p>Given the received verification token is present on the leads table, then the corresponding primary key of the leads table is recorded in the
						membership table, along all the extra info provided in the last form.</p>
						<p>Lastly, this triggers <em>yet another</em> email saying that the application was succesfuly processed and that &quot;you can contact us like bla bla etc&quot; and that
						the organization will be put in contact with them.</p>
						<p>Frontend should be split in two folders, <code>leadgen</code> and <code>membership</code>, to have the corresponding status page after doing something.</p>
						<p>Leadgen contains:</p>
						<ul>
							<li><p>invalid_data:
								Redirect to generic error page if there&#39;s garbage data somewhere in the <code>POST</code> request.</p>
							</li>
							<li><p>verification_notice:
								Redirect to status page aknowledging the person&#39;s affiliation and requesting a verification from the email provided.</p>
							</li>
							<li><p>verification_success:
								Redirect to page where the email verification is noted and the person&#39;s welcomed to us.</p>
							</li>
						</ul>
						<p>Membership contains:</p>
						<ul>
							<li><p>application_success:
								Redirect to page saying the application for membership was successful and that we&#39;ll contact them soon enough.</p>
							</li>
							<li><p>invalid_token:
								Redirect to page saying the UID is garbage; this would be in the shape of a generic &quot;Something went wrong :(&quot; display.</p>
							</li>
							<li><p>invalid_data:
								Redirect to a generic error page like in the case of the leadgen, but with minor changes to relate to the membership process.</p>
							</li>
						</ul>
						<hr>
						<a href="#comments" id="comments" style="color: inherit; text-decoration: none;">
							<h3>Comments</h3>
						</a>
						<p>TODO:Major Add part of the workflow that incorporates donations once that part is more ready to be presented to the world</p>
						<p>TODO:Minor Add the email stuff; the cleanliness will be important to make sure this file is not a hodgepodge of code thrown together.</p>
						<hr>
					</div>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported">
					<a name="leadstable" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagConst">Const</span> leads<wbr>Table</h3>
					<div class="tsd-signature tsd-kind-icon">leads<wbr>Table<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Types.tableField</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol"> = JSON.parse(readFileSync(resolve(__dirname, &quot;../tables/leads.json&quot;)).toString())</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in <a href="https://github.com/aordano/membership-form/blob/fd09695/src/routes/index.ts#L43">routes/index.ts:43</a></li>
						</ul>
					</aside>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported">
					<a name="membership_applicantstable" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagConst">Const</span> membership_<wbr>applicants<wbr>Table</h3>
					<div class="tsd-signature tsd-kind-icon">membership_<wbr>applicants<wbr>Table<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Types.tableField</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol"> = JSON.parse(readFileSync(resolve(__dirname, &quot;../tables/membership_applicants.json&quot;)).toString())</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in <a href="https://github.com/aordano/membership-form/blob/fd09695/src/routes/index.ts#L47">routes/index.ts:47</a></li>
						</ul>
					</aside>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported">
					<a name="router" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagConst">Const</span> router</h3>
					<div class="tsd-signature tsd-kind-icon">router<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Router</span><span class="tsd-signature-symbol"> = express.Router()</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in <a href="https://github.com/aordano/membership-form/blob/fd09695/src/routes/index.ts#L40">routes/index.ts:40</a></li>
						</ul>
					</aside>
				</section>
			</section>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="../globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-module">
						<a href="_app_.html">&quot;app&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="_logic_db_.html">&quot;logic/db&quot;</a>
					</li>
					<li class="current tsd-kind-module">
						<a href="_routes_index_.html">&quot;routes/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="_types_index_.html">&quot;types/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="_utils_db_.html">&quot;utils/db&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="_utils_functions_.html">&quot;utils/functions&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="_utils_index_.html">&quot;utils/index&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-variable tsd-parent-kind-module">
						<a href="_routes_index_.html#postroute" class="tsd-kind-icon">Post<wbr>Route</a>
					</li>
					<li class=" tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported">
						<a href="_routes_index_.html#leadstable" class="tsd-kind-icon">leads<wbr>Table</a>
					</li>
					<li class=" tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported">
						<a href="_routes_index_.html#membership_applicantstable" class="tsd-kind-icon">membership_<wbr>applicants<wbr>Table</a>
					</li>
					<li class=" tsd-kind-variable tsd-parent-kind-module tsd-is-not-exported">
						<a href="_routes_index_.html#router" class="tsd-kind-icon">router</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../assets/js/main.js"></script>
</body>
</html>